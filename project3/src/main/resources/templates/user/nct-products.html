<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${nctPageTitle}">Sản phẩm - UMACT Store</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/nct-user-style.css}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
</head>

<body style="margin-top: 55px;">
<div th:replace="~{fragments/nct-header :: header}"></div>

<div th:replace="~{fragments/nct-sidebar :: sidebar(activePage='products')}"></div>
<!-- Success/Error Messages -->
<div th:if="${successMessage}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline" th:text="${successMessage}"></span>
</div>
<div th:if="${errorMessage}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline" th:text="${errorMessage}"></span>
</div>

<main class="main-content">
    <div class="page-header">
        <div>
            <h1 th:text="${nctHeaderTitle}">Tất cả sản phẩm</h1>
            <p style="color: #999; margin-top: 5px;">
                Trang này hiện có <span th:text="${nctProducts.size()}">0</span> sản phẩm
            </p>
        </div>
        <div class="filter-options">
            <a th:href="@{/products(sort='newest', category=${nctSelectedCategoryId}, search=${nctSearchKeyword})}"
               class="filter-btn"
               th:classappend="${nctSort == 'newest' or nctSort == null} ? ' active' : ''">Mới nhất</a>

            <a th:href="@{/products(sort='priceAsc', category=${nctSelectedCategoryId}, search=${nctSearchKeyword})}"
               class="filter-btn"
               th:classappend="${nctSort == 'priceAsc'} ? ' active' : ''">Giá thấp</a>

            <a th:href="@{/products(sort='priceDesc', category=${nctSelectedCategoryId}, search=${nctSearchKeyword})}"
               class="filter-btn"
               th:classappend="${nctSort == 'priceDesc'} ? ' active' : ''">Giá cao</a>
        </div>
    </div>

    <div th:if="${!nctProducts.isEmpty()}" class="product-grid">
        <div th:each="product : ${nctProducts}" class="product-card">
            <a th:href="@{/products/{id}(id=${product.nctProductId})}" style="text-decoration: none; color: inherit;">
                <div class="product-image">
                    <img th:src="${product.nctImageUrl}"
                         th:alt="${product.nctProductName}"
                         onerror="this.src='https://via.placeholder.com/400x400/f0f0f0/999?text=No+Image'">
                </div>
                <div class="product-info">
                    <div class="product-name" th:text="${product.nctProductName}"></div>
                    <div class="product-price" th:text="|₫ ${#numbers.formatDecimal(product.nctPrice, 0, 'COMMA', 0, 'POINT')}|"></div>
                    <div th:if="${product.nctOriginalPrice != null and product.nctOriginalPrice > product.nctPrice}"
                         class="product-original-price"
                         th:text="|₫ ${#numbers.formatDecimal(product.nctOriginalPrice, 0, 'COMMA', 0, 'POINT')}|"></div>
                    <div th:class="${product.nctStockQuantity > 0 ? 'product-stock available' : 'product-stock out'}"
                         th:text="${product.nctStockQuantity > 0 ? 'Còn ' + product.nctStockQuantity + ' sản phẩm' : 'Hết hàng'}"></div>
                </div>
            </a>
        </div>
    </div>

    <div th:if="${nctProducts.isEmpty()}" class="empty-state">
        <i class="fas fa-box-open"></i>
        <p>Không tìm thấy sản phẩm nào</p>
        <a th:href="@{/products}">Xem tất cả sản phẩm</a>
    </div>
    <div class="mt-8 flex justify-center" th:if="${totalPages > 1}">
        <nav aria-label="Page navigation">
            <ul class="flex list-style-none">

                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled pointer-events-none opacity-50'">
                    <a class="page-link relative block py-1.5 px-3 border-0 bg-transparent outline-none transition-all duration-300 rounded text-gray-800 hover:text-gray-800 hover:bg-gray-200 focus:shadow-none"
                       th:href="@{/products(page=${currentPage - 1}, category=${nctSelectedCategoryId}, search=${nctSearchKeyword}, sort=${nctSort})}">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>

                <li class="page-item"
                    th:each="i : ${#numbers.sequence(1, totalPages)}"
                    th:style="${currentPage == i} ? 'background-color: #e74c3c; border-radius: 0.25rem;' : ''">

                    <a class="page-link relative block py-1.5 px-3 border-0 outline-none transition-all duration-300 rounded hover:bg-gray-200 focus:shadow-none"
                       th:style="${currentPage == i} ? 'color: white;' : 'color: #1f2937;'"
                       th:href="@{/products(page=${i}, category=${nctSelectedCategoryId}, search=${nctSearchKeyword}, sort=${nctSort})}"
                       th:text="${i}">
                    </a>
                </li>

                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled pointer-events-none opacity-50'">
                    <a class="page-link relative block py-1.5 px-3 border-0 bg-transparent outline-none transition-all duration-300 rounded text-gray-800 hover:text-gray-800 hover:bg-gray-200 focus:shadow-none"
                       th:href="@{/products(page=${currentPage + 1}, category=${nctSelectedCategoryId}, search=${nctSearchKeyword}, sort=${nctSort})}">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</main>
<div th:replace="~{fragments/nct-chat-model :: nct-chat-model(pageContext='*', contextProduct=null)}"></div>
<div th:replace="~{fragments/nct-footer :: footer}"></div>

</body>
</html>
